# AgMIP_calibration_PhaseIV_step2_synthetic_experiment
Application of AgMIP Calibration Phase IV protocol with the STICS soil-crop model on synthetic data

This repository gathers the code and data used for the application of AgMIP Calibration Phase IV protocol with the STICS soil-crop model on synthetic data as describe in https://www.biorxiv.org/content/10.1101/2023.10.26.564162v2.full.pdf.

This code is largely based on the use of the R packages [CroptimizR](https://github.com/SticsRPacks/CroptimizR) and [CroPlotR](https://github.com/SticsRPacks/CroPlotR) although they did not include a full implementation of the AgMIP phase IV calibration protocol at the time this study was performed. This should be done in future versions of the CroptimizR package.

Those interested in applying the protocol to other models/data can refer to the repository https://github.com/sbuis/AgMIP-Calibration-Phase-IV.


## Content

* AgMIP_calibration_PhaseIV_step2_synthetic_experiment.Rproj: the R project. Open it in RStudio before running the application.
* main_script_stics.R: the main R script to run the application.
* data folder: includes raw input data decribing the simulated situations, mask for results files, and the EXCEL file describing the application of the calibration protocol to the STICS model on the given dataset.
* stics_input_files folder: includes the STICS input files associated with the situations to simulate. 
* R folder: includes functions used in main_script_stics.R

## Running the Application

* Download first the STICS soil-crop model version 8.5.0 (at https://eng-stics.paca.hub.inrae.fr/).
* Set the corresponding installation path in the variable javastics_path defined in the file main_script_stics.R.
* Open AgMIP_calibration_PhaseIV_step2_synthetic_experiment.Rproj in Rstudio and run main_script_stics.R.
* There are many different options in main_script_stics.R. They have been set by default to the values used for the application described in https://www.biorxiv.org/content/10.1101/2023.10.26.564162v2.full.pdf.


## Results

A set of files containing results is automatically generated by running main_script_stics.R (by default in folder results/French/A):

* **cal_4_results_French_true_values_STICS.txt**:	the true values generated for both calibration and evaluation datasets for the variables required in the protocol
* **cal_4_obs_French_true_values_STICS.txt**  and **cal_4_obs_French_noisy_values_01_STICS.txt**:	the true and noisy values generated for the observations used
* **cal_4_results_French_A_default_values_STICS.txt**:	the simulated values for both calibration and evaluation datasets for the variables required in the protocol before iteration1 (i.e. simulated values obtained using default values of the parameters)
* **cal_4_results_French_A_numerical_it\#_STICS.txt**:	the simulated values for both calibration and evaluation datasets for the variables required in the protocol after iteration number \#
* **scatterPlots_default.pdf**: scatter plots of simulated VS observed values of the variables used on the calibration dataset before iteration1 (i.e. simulated values obtained using default values of the parameters)
* **scatterPlots_it\#.pdf** (one file per iteration): scatter plots of simulated VS observed values of the variables used on the calibration dataset after iteration number \#
* **synth_almost_additive_parameters_0.6.csv** and **synth_candidate_parameters_0.6.csv**: description of the parameters used in the synthetic experiments (extraction of tabs provided in protocol_descr_\*\*\*.xlsx, BUT with perturbed values for the default values of the parameters)
* **Table_parameters_iteration\#.csv** (one file per iteration), includes information on the estimaetd parameters (name, default value, selected initial value, estimated value), for the given iteration and for each estimated parameter
* **Table_variables_iteration\#.csv** (one file per iteration), includes values of goodness-of-fit criteria computed using default and final estimated values of the parameters on the calibration dataset, for each observed variable used
* **Table_steps_iteration\#.csv** (one file per iteration), includes information about the estimation procedure (names of the estimated parameters, number of starting values tested, ...), for the given iteration and for each step within the iteration
* folders **Iteration\#**: one folder per iteration including the standard outputs generated by the CroptimizR package
* folder **DailyOutputs**: daily simulated values for each situation (one file per situation), using default values of the parameters (subfolder Default) and using estimated values of the parameters after Iteration number \# (subfolder Iteration\#)  




